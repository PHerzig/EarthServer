<!DOCTYPE >
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>Earth Demo</title>

    <link rel="stylesheet" type="text/css" href="css/x3dom.css" />
    <link rel="stylesheet" type="text/css" href="css/earthservergenericclient.css" />
    <link rel="stylesheet" type="text/css" href="js-ext/jquery-ui/themes/base/jquery-ui.css">

	<script type="text/javascript" src="js-ext/x3dom-full.js"></script>
    <script type="text/javascript" src="js-ext/jquery-ui/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="js-ext/jquery-ui/ui/jquery-ui.js"></script>

    <script type="text/javascript" src="js/EarthServerClient.js"></script>

    <script type="text/javascript">
    // basic setup:
    EarthServerGenericClient.MainScene.setTimeLog(false);//TimeLogging: outputs time of loading and building the models to the console
    EarthServerGenericClient.MainScene.addLightToScene(true);//Adds a light into the scene
    // background of the render window
    EarthServerGenericClient.MainScene.setBackground("0.8 0.8 0.95 0.4 0.5 0.85 0.3 0.5 0.85 0.31 0.52 0.85","0.9 1.5 1.57","0.8 0.8 0.95 0.4 0.5 0.85 0.3 0.5 0.85 0.31 0.52 0.85","0.9 1.5 1.57");

    // create the models:
    $(document).ready(function()
    {
        var BGS = new EarthServerGenericClient.Model_WCPSDemAlpha();
        BGS.setName("BGS");
        BGS.setURL("http://earthserver.bgs.ac.uk/petascope");
        BGS.setCoverages("bgs_rs", "os_dtm");
        BGS.setAreaOfInterest(400000,500000,450000,550000);
        BGS.setCoordinateReferenceSystem("http://www.opengis.net/def/crs/EPSG/0/27700");
        BGS.setScale(1.0,0.3,1.0);//Size within the cube 100%width, 30%height and 100%length
        BGS.setResolution(1000,1000);//Resolution of the model
        BGS.setProgressiveLoading(false);//Progressive Loading in three steps.

        /*var WMS =  new EarthServerGenericClient.Model_WMSDemWCS();
        WMS.setName("WMS_WCS");
        WMS.setURLs("http://planetserver.jacobs-university.de:8080/petascope/wms","http://planetserver.jacobs-university.de:8080/petascope");
        WMS.setCoverages("galehrsc_wms","galehrscdtm");
        WMS.setWMSVersion("1.1");
        WMS.setCoordinateReferenceSystem("SRS","EPSG:4326");
        WMS.setAreaOfInterest(137,-6,138,-5);
        WMS.setResolution(1000,1000);
        WMS.setOffset(0,0.4,0);*/

        /*var BGS_LOW = new EarthServerGenericClient.Model_WCPSDemAlpha();
         BGS_LOW.setName("BGS Low Resolution");
         BGS_LOW.setURL("http://earthserver.bgs.ac.uk/petascope");
         BGS_LOW.setCoverages("bgs_rs", "os_dtm");
         BGS_LOW.setAreaOfInterest(400000,500000,450000,550000);
         BGS_LOW.setScale(1.0,0.2,1.0);
         BGS_LOW.setOffset(0,0.4,0);
         BGS_LOW.setResolution(200,200);
         BGS_LOW.setWCPSForChannelRED('scale(trim($CI.red, {x($MINX:$MAXX), y($MINY:$MAXY) }), {x:"CRS:1"(0:$RESX), y:"CRS:1"(0:$RESZ)}, {});');
         BGS_LOW.setWCPSForChannelGREEN('scale(trim($CI.green, {x($MINX:$MAXX), y($MINY:$MAXY) }), {x:"CRS:1"(0:$RESX), y:"CRS:1"(0:$RESZ)}, {});');
         BGS_LOW.setWCPSForChannelBLUE('scale(trim($CI.blue, {x($MINX:$MAXX), y($MINY:$MAXY) }), {x:"CRS:1"(0:$RESX), y:"CRS:1"(0:$RESZ)}, {});');
         BGS_LOW.setWCPSForChannelALPHA('(char) (((scale(trim(dtm , {x($MINX:$MAXX), y($MINY:$MAXY)}), {x:"CRS:1"(0:$RESX), y:"CRS:1"(0:$RESZ)}, {})) / 1349) * 255)');*/

        var JUB = new EarthServerGenericClient.Model_WCPSDemWCS();
        JUB.setName("JUB");
        JUB.setURLs("http://planetserver.jacobs-university.de:8080/petascope/wcps.php","http:///planetserver.jacobs-university.de:8080/petascope");
        JUB.setCoverages("FRT0000C51807L","galehrscdtm");
        JUB.setAreaOfInterest(137,-6,138,-5);
        JUB.setResolution(1000,1000);
        JUB.setOffset(0,0.4,0);// model has a 40% offset in height of the cube
        JUB.setTransparency(0);// initial transparency of the model

        var JUB_query = 'for data in ( $CI ) return encode( (char)({';
        JUB_query += 'red: (char) (255 / (max(((data.100)!=65535) * (data.100)) - min(data.100))) * ((data.100) - min(data.100));';
        JUB_query += 'green: (char) (255 / (max(((data.200)!=65535) * (data.200)) - min(data.200))) * ((data.200) - min(data.200));';
        JUB_query += 'blue: (char) (255 / (max(((data.300)!=65535) * (data.300)) - min(data.300))) * ((data.300) - min(data.300))';
        JUB_query += ', "png" )';
        JUB.setWCPSQuery(JUB_query);

        // add models to the scene
        EarthServerGenericClient.MainScene.addModel(BGS);
        //EarthServerGenericClient.MainScene.addModel(BGS_LOW);
        EarthServerGenericClient.MainScene.addModel(JUB);
        //EarthServerGenericClient.MainScene.addModel(WMS);

        // create the scene: Cube has 50% height compared to width and length
        EarthServerGenericClient.MainScene.createScene('x3d','x3dScene',1,0.5,1 );

        // add annotation layers and annotation (after creating the scene)
        EarthServerGenericClient.MainScene.addAnnotationsLayer("Layer1","JUB",50,"1 1 1",25,6,"1 1 1");
        EarthServerGenericClient.MainScene.addAnnotation("Layer1",310,35,-170,"CityName");
        EarthServerGenericClient.MainScene.addAnnotation("Layer1",200,-45,400,"You can annotate here");

        // create the UI and axis labels
        EarthServerGenericClient.MainScene.createUI('x3domUI');
        EarthServerGenericClient.MainScene.setAxisLabels("Latitude","Height","Longitude");
        EarthServerGenericClient.MainScene.createAxisLabels();
    });

    document.onload = function()
    {
        // register a progressbar (you can register your own or just delete this lines)
        var pb = new EarthServerGenericClient.createProgressBar("progressbar");
        EarthServerGenericClient.MainScene.setProgressCallback(pb.updateValue);

        // starts loading and creating the models
        // here the function starts as soon as the html page is fully loaded
        // you can map this function to e.g. a button
        EarthServerGenericClient.MainScene.createModels();
    };
    </script>

</head>
<body id="body">



    <div id="x3dom">
        <div id="progressbar"></div>
        <X3D id="x3d" showlog="false" showstat="false">
            <scene id="x3dScene"></scene>
        </X3D>

        <div id='x3domUI'></div>
    </div>



</body>
</html>